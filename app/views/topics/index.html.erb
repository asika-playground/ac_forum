<h1>Topics</h1>
<% if @category %>
  <h3>Category: <%= @category %></h3>
<% end %>

<%= link_to new_topic_path, :class => "btn btn-primary" do %>
  New Topic
<% end %>
  <%= link_to topics_path do %>
      <span class="badge">All</span>
  <% end %>

  <% @categories.each do |cat| %>
    <%= link_to topics_path( :cate => cat.id ) do %>
      <span class="badge"><%= cat.name %></span>
    <% end %>
  <% end %>

  <%= link_to topics_path( :cate => 0) do %>
      <span class="badge">Uncategoried</span>
  <% end %>

<div>

</div>

<table class="table table-striped table-bordered">
  <tr>
    <td></td>
    <td>Topic</td>
    <td>Category</td>
    <td>Users</td>
    <td><%= link_to "Replies", topics_path( merge_topic_filters(params, :sort => "comments_count", :order => "desc") ) %></td>
    <td><%= link_to "Views", topics_path( merge_topic_filters(params, :sort => "views", :order => "desc") ) %></td>
    <td><%= link_to "Updated", topics_path( merge_topic_filters(params, :sort => "updated_at", :order => "desc") ) %></td>
  </tr>

  <% @topics.each do |t| %>
    <tr>
      <td><%= t.id %></td>
      <td class="col-md-6"><%= link_to t.title, topic_path(t) %></td>
      <td>
        <% t.categories.each do |cat| %>
          <%= link_to topics_path( :cate => cat.id ) do %>
            <span class="badge"><%= cat.name %></span>
          <% end %>
        <% end %>
      </td>
      <td>
        <% t.users_unique.each do |user| %>
          <%= link_to user.username, user_path(user.id) %>
        <% end %>
      </td>
      <td><%= t.comments.size %></td>
      <td><%= t.views %></td>
      <td><%= t.updated_at.to_s(:short) %></td>
    </tr>
  <% end %>
</table>

<%= paginate @topics %>
